---
import SectionContainer from "@/components/SectionContainer.astro"
import i18next from "@/i18n/config.js"

const lang = Astro.url.pathname.split("/")[1] || "es"
const translations = i18next.getResourceBundle(lang, "translation")
const cookies = translations.Cookies
const bannerCookies = translations.bannerCookies
---

<SectionContainer class="px-0 py-10">
	<h1 class="mb-6 text-3xl font-bold text-primary">{cookies.title}</h1>
	<section class="mb-4 space-y-4">
		<h2 class="text-xl font-semibold">{cookies.cookies1.heading}</h2>
		<p>{cookies.cookies1.content1}</p>
		<p>{cookies.cookies1.content2}</p>
	</section>
	<section class="mb-4 space-y-4">
		<h2 class="text-xl font-semibold">{cookies.cookies2.heading}</h2>
		<p>{cookies.cookies2.content1}</p>
	</section>
	<section class="mb-4 space-y-4">
		<h2 class="text-xl font-semibold">{cookies.cookies3.heading}</h2>
		<p>{cookies.cookies3.content1}</p>
		<section class="mb-4 space-y-4 pl-5">
			<h4 class="text-xl font-semibold">{cookies.cookies3.cookies31.heading}</h4>
			<ul class="mt-2 list-disc space-y-2 pl-6">
				<li>
					<strong>{cookies.cookies3.cookies31.content2}</strong>
					{cookies.cookies3.cookies31.content21}
				</li>
				<li>
					<strong>{cookies.cookies3.cookies31.content3}</strong>
					{cookies.cookies3.cookies31.content31}
				</li>
				<li>
					<strong>{cookies.cookies3.cookies31.content4}</strong>{
						cookies.cookies3.cookies31.content41
					}
				</li>
				<li>
					<strong>{cookies.cookies3.cookies31.content5}</strong>
					{cookies.cookies3.cookies31.content51}
				</li>
			</ul>
		</section>
		<section class="mb-4 space-y-4 pl-5">
			<h4 class="text-xl font-semibold">{cookies.cookies3.cookies32.heading}</h4>
			<ul class="mt-2 list-disc space-y-2 pl-6">
				<li>
					<strong>{cookies.cookies3.cookies32.content2}</strong>
					{cookies.cookies3.cookies32.content21}
				</li>
				<li>
					<strong>{cookies.cookies3.cookies32.content3}</strong>
					{cookies.cookies3.cookies32.content31}
				</li>
			</ul>
		</section>
		<section class="mb-4 space-y-4 pl-5">
			<h4 class="text-xl font-semibold">{cookies.cookies3.cookies33.heading}</h4>
			<ul class="mt-2 list-disc space-y-2 pl-6">
				<li>
					<strong>{cookies.cookies3.cookies33.content2}</strong>
					{cookies.cookies3.cookies33.content21}
				</li>
				<li>
					<strong>{cookies.cookies3.cookies33.content3}</strong>
					{cookies.cookies3.cookies33.content31}
				</li>
			</ul>
		</section>
	</section>
	<section class="mb-4 space-y-4">
		<h4 class="text-xl font-semibold">{cookies.cookies4.heading}</h4>
		<p>{cookies.cookies4.content1}</p>
		<ul class="mt-2 list-disc space-y-2 pl-6">
			<li>
				<strong>{cookies.cookies4.content2}</strong>
				<a href="www.aepd.es">{cookies.cookies4.contentURL}</a>
			</li>
			<li>
				<strong>{cookies.cookies4.content3}</strong>
				<a href="www.aepd.es">{cookies.cookies4.contentURL}</a>
			</li>
			<li>
				<strong>{cookies.cookies4.content4}</strong>
				<a href="www.aepd.es">{cookies.cookies4.contentURL}</a>
			</li>
			<li>
				<strong>{cookies.cookies4.content5}</strong>
				<a href="www.aepd.es">{cookies.cookies4.contentURL}</a>
			</li>
		</ul>
		<p>{cookies.cookies4.content6}</p>
		<h5 class="text-xl font-semibold">{cookies.cookies4.content7}</h5>
		<ul class="mt-2 list-disc space-y-2 pl-6">
			<li class="flex items-center justify-between">
				<strong>{cookies.cookies4.content8}</strong>
				<label class="relative inline-flex cursor-pointer items-center">
					<input type="checkbox" id="google-cookies" class="peer sr-only" />
					<div
						class="peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5 after:rounded-full after:border after:bg-white after:transition-all after:content-[''] peer-checked:bg-primary peer-checked:after:translate-x-5 peer-checked:after:border-white"
					>
					</div>
				</label>
			</li>
			<li class="flex items-center justify-between">
				<strong>{cookies.cookies5.content2}</strong>
				<label class="relative inline-flex cursor-pointer items-center">
					<input type="checkbox" id="analytics-cookies" class="peer sr-only" />
					<div
						class="peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5 after:rounded-full after:border after:bg-white after:transition-all after:content-[''] peer-checked:bg-primary peer-checked:after:translate-x-5 peer-checked:after:border-white"
					>
					</div>
				</label>
			</li>
		</ul>

		<!-- Botones de acción -->
		<div class="mt-6 flex justify-center gap-6">
			<button
				id="accept-all"
				class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white transition hover:bg-secondary"
			>
				{cookies.bannerCookies.accept}
			</button>
			<button
				id="delete-all"
				class="rounded-lg border-2 border-primary px-4 py-2 text-sm font-bold text-primary transition hover:bg-primary hover:text-white"
			>
				{cookies.bannerCookies.decline}
			</button>
			<button
				id="save-settings"
				class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white transition hover:bg-secondary"
			>
				{cookies.bannerCookies.save}
			</button>
		</div>
	</section>
	<section class="mb-4 space-y-4">
		<h4 class="text-xl font-semibold">{cookies.cookies5.heading}</h4>
		<p>{cookies.cookies5.content1}</p>
		<ul class="mt-2 list-disc space-y-2 pl-6">
			<li>
				<strong>{cookies.cookies5.content2}</strong>{cookies.cookies5.content5}
				<a href="www.aepd.es">{cookies.cookies5.content21URL}</a>{cookies.cookies5.content51}
			</li>
			<li>
				<strong>{cookies.cookies5.content3}</strong>{cookies.cookies5.content5}
				<a href="www.aepd.es">{cookies.cookies5.content31URL}</a>{cookies.cookies5.content51}
			</li>
			<li>
				<strong>{cookies.cookies5.content4}</strong>{cookies.cookies5.content5}
				<a href="www.aepd.es">{cookies.cookies5.content41URL}</a>{cookies.cookies5.content51}
			</li>
		</ul>
	</section>
	<section class="mb-4 space-y-4">
		<h2 class="text-xl font-semibold">{cookies.cookies6.heading}</h2>
		<p>{cookies.cookies6.content1}</p>
	</section>
</SectionContainer>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const googleCheckbox = document.getElementById("google-cookies") as HTMLInputElement
		const analyticsCheckbox = document.getElementById("analytics-cookies") as HTMLInputElement
		const acceptAllBtn = document.getElementById("accept-all") as HTMLButtonElement
		const deleteAllBtn = document.getElementById("delete-all") as HTMLButtonElement
		const saveSettingsBtn = document.getElementById("save-settings") as HTMLButtonElement

		function syncCookieSettings(): void {
			googleCheckbox.checked = localStorage.getItem("googleCookies") === "true"
			analyticsCheckbox.checked = localStorage.getItem("analyticsCookies") === "true"
		}

		syncCookieSettings()

		function setCookie(name: string, value: string, days: number): void {
			let expires = ""
			if (days) {
				const date = new Date()
				date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)
				expires = "; expires=" + date.toUTCString()
			}
			document.cookie = `${name}=${value}${expires}; path=/`
		}

		function deleteCookie(name: string): void {
			document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`
			localStorage.removeItem(name)
		}

		acceptAllBtn.addEventListener("click", () => {
			localStorage.setItem("cookiesAccepted", "true")
			localStorage.setItem("googleCookies", "true")
			localStorage.setItem("analyticsCookies", "true")

			setCookie("googleCookies", "true", 365)
			setCookie("analyticsCookies", "true", 365)
			syncCookieSettings()
		})

		deleteAllBtn.addEventListener("click", () => {
			localStorage.removeItem("googleCookies")
			localStorage.removeItem("analyticsCookies")
			localStorage.removeItem("cookiesAccepted")
			localStorage.setItem("cookiesRejected", "true")

			deleteCookie("googleCookies")
			deleteCookie("analyticsCookies")
			syncCookieSettings()
		})

		saveSettingsBtn.addEventListener("click", () => {
			let anyCookieEnabled = false

			if (googleCheckbox.checked) {
				localStorage.setItem("googleCookies", "true")
				setCookie("googleCookies", "true", 365)
				anyCookieEnabled = true
			} else {
				localStorage.removeItem("googleCookies")
				deleteCookie("googleCookies")
			}

			if (analyticsCheckbox.checked) {
				localStorage.setItem("analyticsCookies", "true")
				setCookie("analyticsCookies", "true", 365)
				anyCookieEnabled = true
			} else {
				localStorage.removeItem("analyticsCookies")
				deleteCookie("analyticsCookies")
			}

			// Solo marcar cookies aceptadas si al menos una está activada
			if (anyCookieEnabled) {
				localStorage.setItem("cookiesAccepted", "true")
			} else {
				localStorage.removeItem("cookiesAccepted")
			}

			syncCookieSettings()
		})
	})
</script>
