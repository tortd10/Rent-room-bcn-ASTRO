<style>
	.mobile-menu {
		position: absolute;
		top: 100%;
		right: 0;
		background: var(--headerBg, white);
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		width: 100%;
		display: flex;
		flex-direction: column;
		padding: 1rem;
		gap: 0.5rem;
		width: 100%;
		text-align: center;
	}

	.hidden {
		display: none;
	}

	img {
		width: 15rem;
	}

	@media (min-width: 768px) {
		.desktop-menu {
			display: flex;
		}

		.mobile-menu {
			display: none;
		}
	}
</style>

<header
	class="sticky top-0 z-50 flex w-full items-center justify-between bg-headerBg px-9 py-4 backdrop-blur-xl"
>
	<div class="flex w-full items-center justify-between md:mx-auto md:max-w-[1400px]">
		<!-- Logo -->
		<a href="/">
			<img src="/logo.svg" alt="Logo RentRoomBcn" />
		</a>

		<!-- Menú desktop (inicialmente oculto hasta que JS lo active) -->
		<div class="desktop-menu hidden" id="desktop-menu">
			<button id="logout-button-desktop" class="hover:text-primaryDark hidden text-sm font-medium">
				Cerrar sesión
			</button>
		</div>

		<!-- Menú mobile (inicialmente oculto hasta que JS lo active) -->
		<button id="mobile-menu-button" class="flex hidden items-center p-2 md:hidden">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="h-6 w-6"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"
				></path>
			</svg>
		</button>
	</div>
</header>

<script>
	import { supabase } from "@/lib/supabase"
	document.addEventListener("DOMContentLoaded", async () => {
		try {
			// 1. Verificar sesión
			const {
				data: { session },
			} = await supabase.auth.getSession()

			// 2. Mostrar elementos solo si está logueado
			if (session) {
				// Mostrar botón de logout en desktop
				const desktopMenu = document.getElementById("desktop-menu")
				const logoutBtnDesktop = document.getElementById("logout-button-desktop")

				if (desktopMenu && logoutBtnDesktop) {
					desktopMenu.classList.remove("hidden")
					logoutBtnDesktop.classList.remove("hidden")

					// Manejar logout
					logoutBtnDesktop.addEventListener("click", async () => {
						const { error } = await supabase.auth.signOut()
						if (!error) window.location.href = "/admin"
					})
				}

				// Mostrar botón mobile
				const mobileMenuBtn = document.getElementById("mobile-menu-button")
				if (mobileMenuBtn) {
					mobileMenuBtn.classList.remove("hidden")

					// Manejar logout en mobile
					mobileMenuBtn.addEventListener("click", async () => {
						const { error } = await supabase.auth.signOut()
						if (!error) window.location.href = "/admin"
					})
				}
			}
		} catch (error) {
			console.error("Error checking auth:", error)
		}
	})
</script>
