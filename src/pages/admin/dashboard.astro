---
import LayoutAdmin from "@/layouts/LayoutAdmin.astro"
import { supabase } from "@/lib/supabase"

// Datos estáticos (pre-renderizados)
const { count: roomsCount } = await supabase
	.from("rooms")
	.select("*", { count: "exact", head: true })

const { user } = Astro.locals
---

<LayoutAdmin title="RentRoomBcn - Admin">
	<!-- Script de protección de ruta en cliente -->
	<script is:inline>
		// Verificar si hay sesión al cargar la página
		document.addEventListener("DOMContentLoaded", async () => {
			const {
				data: { session },
			} = await supabase.auth.getSession()
			if (!session) {
				window.location.href = "/admin/login"
			}
		})
	</script>

	<div class="p-6">
		<h1 class="text-2xl font-bold">
			Bienvenido, {user?.email || "Invitado"}
		</h1>

		<div class="dashboard-grid">
			<div class="card">
				<h3>Habitaciones activas</h3>
				<p>{roomsCount}</p>
			</div>

			<div class="card">
				<h3>Reservas activas</h3>
			</div>

			<div class="quick-actions">
				<a href="/admin/rooms/new" class="button">Nueva Habitación</a>
				<a href="/admin/bookings" class="button">Ver Reservas</a>
			</div>
		</div>
	</div>
</LayoutAdmin>

<style>
	.dashboard-grid {
		display: grid;
		gap: 1rem;
		grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
	}
	.card {
		padding: 1.5rem;
		background: white;
		border-radius: 8px;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	}
	.button {
		display: inline-block;
		padding: 0.8rem 1.5rem;
		background: #0070f3;
		color: white;
		border-radius: 4px;
		text-decoration: none;
	}
</style>
